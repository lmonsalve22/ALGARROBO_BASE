<!DOCTYPE html>
<html lang="es">
<head>
    <script>
        // Función para verificar el estado de login
        function checkLoginStatus() {
            const isLoggedIn = localStorage.getItem('isLoggedIn');
            console.log(isLoggedIn)
            
            if (!isLoggedIn || isLoggedIn !== 'true') {
                // Redirigir a la página de login si no está logueado
                window.location.href = 'frontend/index.html';
            }
            
        }
        checkLoginStatus() 
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geoportal Municipal - Algarrobo</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        .sidebar-transition {
            transition: transform 0.3s ease-in-out;
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-blue-600 text-white shadow-lg relative z-40">
        <div class="container mx-auto px-4 py-3">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-4">
                    <i class="fas fa-city text-2xl"></i>
                    <div>
                        <h1 class="text-xl font-bold">Geoportal Municipal</h1>
                        <p class="text-xs text-blue-100">Ilustre Municipalidad de Algarrobo</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="relative">
                        <button onclick="toggleUserMenu()" class="flex items-center space-x-2 hover:bg-blue-700 px-3 py-2 rounded">
                            <i class="fas fa-user-circle"></i>
                            <span id="currentRole">Administrador</span>
                            <i class="fas fa-chevron-down text-xs"></i>
                        </button>
                        <div id="userMenu" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-xl z-50">
                            <a href="#" onclick="changeRole('admin')" class="block px-4 py-2 text-gray-800 hover:bg-gray-100">
                                <i class="fas fa-user-shield mr-2"></i> Administrador
                            </a>
                            <a href="#" onclick="changeRole('alcalde')" class="block px-4 py-2 text-gray-800 hover:bg-gray-100">
                                <i class="fas fa-user-tie mr-2"></i> Alcalde
                            </a>
                            <a href="#" onclick="changeRole('secplac')" class="block px-4 py-2 text-gray-800 hover:bg-gray-100">
                                <i class="fas fa-users mr-2"></i> SECPLAC
                            </a>
                            <a href="#" onclick="changeRole('public')" class="block px-4 py-2 text-gray-800 hover:bg-gray-100">
                                <i class="fas fa-eye mr-2"></i> Vista Pública
                            </a>
                            <hr class="my-1">
                            <a href="#" class="block px-4 py-2 text-gray-800 hover:bg-gray-100">
                                <i class="fas fa-cog mr-2"></i> Configuración
                            </a>
                            <a href="#" onclick="logout()" class="block px-4 py-2 text-gray-800 hover:bg-gray-100">
                                <i class="fas fa-sign-out-alt mr-2"></i> Salir
                            </a>
                        </div>
                    </div>
                    <button onclick="toggleNotifications()" class="relative hover:bg-blue-700 p-2 rounded">
                        <i class="fas fa-bell"></i>
                        <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">3</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <div class="flex">
        <!-- Sidebar -->
        <aside id="sidebar" class="w-64 bg-white shadow-lg h-screen sticky top-0 sidebar-transition z-30">
            <nav class="p-4">
                <ul class="space-y-2">
                    <li>
                        <a href="#" onclick="showView('dashboard')" class="nav-item flex items-center space-x-3 p-3 rounded-lg bg-blue-50 text-blue-600">
                            <i class="fas fa-tachometer-alt w-5"></i>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li class="pt-4 mt-4 border-t">
                        <p class="text-xs text-gray-500 uppercase font-semibold px-3">Módulos</p>
                    </li>
                    <li>
                        <a href="#" class="nav-item flex items-center space-x-3 p-3 rounded-lg hover:bg-blue-50 text-gray-700">
                            <i class="fas fa-road w-5"></i>
                            <span>Vialidad</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="nav-item flex items-center space-x-3 p-3 rounded-lg hover:bg-blue-50 text-gray-700">
                            <i class="fas fa-tint w-5"></i>
                            <span>Saneamiento</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="nav-item flex items-center space-x-3 p-3 rounded-lg hover:bg-blue-50 text-gray-700">
                            <i class="fas fa-tree w-5"></i>
                            <span>Espacios Públicos</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 p-6">
            <!-- Dashboard View -->
            <div id="dashboardView" class="view-content">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">Dashboard Principal</h2>
                    <p class="text-gray-600">Resumen ejecutivo de la gestión municipal</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                    <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-lg shadow p-6 text-white">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-blue-100">Proyectos Activos</p>
                                <p class="text-3xl font-bold">92</p>
                                <p class="text-sm text-blue-100 mt-2">
                                    <i class="fas fa-arrow-up mr-1"></i>12% vs mes anterior
                                </p>
                            </div>
                            <i class="fas fa-chart-pie text-4xl text-blue-200"></i>
                        </div>
                    </div>
                    <div class="bg-gradient-to-r from-green-500 to-green-600 rounded-lg shadow p-6 text-white">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-green-100">Inversión Total</p>
                                <p class="text-3xl font-bold">$25.3B</p>
                                <p class="text-sm text-green-100 mt-2">
                                    <i class="fas fa-arrow-up mr-1"></i>8% vs año anterior
                                </p>
                            </div>
                            <i class="fas fa-dollar-sign text-4xl text-green-200"></i>
                        </div>
                    </div>
                    <div class="bg-gradient-to-r from-purple-500 to-purple-600 rounded-lg shadow p-6 text-white">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-purple-100">Tasa de Avance</p>
                                <p class="text-3xl font-bold">58%</p>
                                <p class="text-sm text-purple-100 mt-2">
                                    <i class="fas fa-arrow-up mr-1"></i>5% vs mes anterior
                                </p>
                            </div>
                            <i class="fas fa-tasks text-4xl text-purple-200"></i>
                        </div>
                    </div>
                    <div class="bg-gradient-to-r from-orange-500 to-orange-600 rounded-lg shadow p-6 text-white">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-orange-100">Beneficiarios</p>
                                <p class="text-3xl font-bold">15.2K</p>
                                <p class="text-sm text-orange-100 mt-2">
                                    <i class="fas fa-users mr-1"></i>Estimado
                                </p>
                            </div>
                            <i class="fas fa-user-friends text-4xl text-orange-200"></i>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold mb-4">Proyectos por Área</h3>
                        <canvas id="areaChart"></canvas>
                    </div>
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold mb-4">Estado de Proyectos</h3>
                        <canvas id="statusChart"></canvas>
                    </div>
                </div>

                <div class="mt-6 bg-white rounded-lg shadow p-6">
                    <h3 class="text-lg font-semibold mb-4">Proyectos Recientes</h3>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                            <div class="flex items-center space-x-4">
                                <div class="bg-blue-100 p-3 rounded-full">
                                    <i class="fas fa-road text-blue-600"></i>
                                </div>
                                <div>
                                    <p class="font-semibold">Pavimentación Avda. Santa Teresa</p>
                                    <p class="text-sm text-gray-600">Vialidad - $2,000M</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <span class="status-badge bg-yellow-100 text-yellow-800">En Licitación</span>
                                <p class="text-sm text-gray-500 mt-1">Actualizado hace 2 días</p>
                            </div>
                        </div>
                        <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                            <div class="flex items-center space-x-4">
                                <div class="bg-green-100 p-3 rounded-full">
                                    <i class="fas fa-school text-green-600"></i>
                                </div>
                                <div>
                                    <p class="font-semibold">Mejoramiento Escuela San José</p>
                                    <p class="text-sm text-gray-600">Educación - $130M</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <span class="status-badge bg-green-100 text-green-800">En Ejecución</span>
                                <p class="text-sm text-gray-500 mt-1">Actualizado hace 1 semana</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <script>
        // Verificar si el usuario está logueado al cargar la página
        document.addEventListener('DOMContentLoaded', function() {
            checkLoginStatus();
            initializeCharts();
        });

        

        // Función para logout
        function logout() {
            // Eliminar la sesión del usuario
            localStorage.removeItem('isLoggedIn');
            localStorage.removeItem('userRole');
            
            // Redirigir a la página de login
            window.location.href = 'frontend/index.html';
        }

        // Initialize charts
        function initializeCharts() {
            // Area chart
            const areaCtx = document.getElementById('areaChart');
            if (areaCtx) {
                new Chart(areaCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Vialidad', 'Espacios Públicos', 'Saneamiento', 'Educación', 'Salud'],
                        datasets: [{
                            data: [33, 38, 8, 8, 5],
                            backgroundColor: [
                                '#3B82F6',
                                '#10B981',
                                '#F59E0B',
                                '#8B5CF6',
                                '#EF4444'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }

            // Status chart
            const statusCtx = document.getElementById('statusChart');
            if (statusCtx) {
                new Chart(statusCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Diseño', 'Ejecución', 'Licitación', 'En preparación', 'Aprobado'],
                        datasets: [{
                            label: 'Proyectos',
                            data: [25, 12, 8, 30, 17],
                            backgroundColor: '#3B82F6'
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }
        }

        // View management
        function showView(viewName) {
            // En esta versión simplificada, solo tenemos el dashboard
            // Esta función se mantiene para futuras expansiones
            console.log('Mostrando vista:', viewName);
        }

        // User menu
        function toggleUserMenu() {
            const menu = document.getElementById('userMenu');
            menu.classList.toggle('hidden');
        }

        // Change role
        function changeRole(role) {
            currentRole = role;
            const roleNames = {
                'admin': 'Administrador',
                'alcalde': 'Alcalde',
                'secplac': 'SECPLAC',
                'public': 'Vista Pública'
            };
            document.getElementById('currentRole').textContent = roleNames[role];
            document.getElementById('userMenu').classList.add('hidden');
            console.log(localStorage)
            // Guardar el rol en localStorage
            localStorage.setItem('userRole', role);
            
            // Aquí se implementaría la lógica para cambiar la vista según el rol
            if (role === 'public') {
                alert('Modo público activado - Se ocultará información sensible');
            }
        }

        // Toggle notifications
        function toggleNotifications() {
            // Implement notification panel
            alert('Panel de notificaciones - En desarrollo');
        }

        // Close menus when clicking outside
        document.addEventListener('click', function(event) {
            const userMenu = document.getElementById('userMenu');
            const userButton = event.target.closest('button[onclick="toggleUserMenu()"]');
            
            if (!userButton && !userMenu.contains(event.target)) {
                userMenu.classList.add('hidden');
            }
        });
    </script>
</body>
</html>