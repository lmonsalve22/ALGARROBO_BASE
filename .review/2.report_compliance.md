# ğŸ›¡ï¸ REPORTE: compliance-reviewer â€” Seguridad Web & Supply Chain
**Fecha**: 2026-02-19 | **Agente**: compliance-reviewer v2.1 | **EstÃ¡ndar**: OWASP Top 10 / GDPR / SRI

---

## SEC-001 Â· Credenciales de base de datos expuestas en repositorio
**â— Hallazgo**: El archivo `backend/.env` contiene la connection string completa de PostgreSQL (Neon) con usuario, contraseÃ±a y host. EstÃ¡ commiteado en el repositorio Git.
**ğŸ”“ Vulnerabilidad**: **Secret Exposure** â€” CWE-798 (Hard-coded Credentials)
**ğŸ“ UbicaciÃ³n**: `backend/.env:1`
```
DATABASE_URL="postgresql://neondb_owner:npg_xHS7sA1FDPqI@ep-hidden-grass-a4sa46kc-pooler.us-east-1.aws.neon.tech/neondb?sslmode=require"
```
**âš ï¸ Severidad**: **ğŸ”´ CRÃTICA**
**ğŸ“œ EstÃ¡ndar**: OWASP A07:2021 â€” Security Misconfiguration / PCI-DSS Req. 6.5.3
**ğŸ› ï¸ MitigaciÃ³n**:
1. **RotaciÃ³n INMEDIATA** de credenciales en Neon dashboard.
2. Agregar `backend/.env` a `.gitignore`.
3. Ejecutar `git filter-repo` para eliminar del historial.
4. Usar variables de entorno del servidor o vault en producciÃ³n.

---

## SEC-002 Â· Supply Chain: TailwindCSS Play CDN sin SRI (40+ pÃ¡ginas)
**â— Hallazgo**: Todas las pÃ¡ginas del proyecto cargan `https://cdn.tailwindcss.com` sin atributo `integrity`. Este CDN ejecuta JavaScript que genera CSS en runtime â€” un compromiso del CDN implica ejecuciÃ³n de cÃ³digo arbitrario en el navegador de todos los usuarios.
**ğŸ”“ Vulnerabilidad**: **Supply Chain Attack** â€” CWE-829
**ğŸ“ UbicaciÃ³n**: 40+ archivos HTML (ej: `frontend/index.html:13`, `dashboard.html:16`, todos los mantenedores)
**âš ï¸ Severidad**: **ğŸ”´ CRÃTICA**
**ğŸ“œ EstÃ¡ndar**: OWASP A08:2021 â€” Software and Data Integrity Failures
**ğŸ› ï¸ MitigaciÃ³n**:
1. **Inmediato**: Migrar a TailwindCSS compilado localmente (`npx tailwindcss build`).
2. TailwindCSS Play CDN no soporta SRI por diseÃ±o (genera contenido dinÃ¡mico).
3. Si se mantiene CDN temporalmente, implementar CSP headers estrictos.

---

## SEC-003 Â· Supply Chain: Font Awesome y Chart.js sin SRI
**â— Hallazgo**: Font Awesome (cdnjs.cloudflare.com) y Chart.js (cdn.jsdelivr.net) se cargan sin atributos `integrity` ni `crossorigin`.
**ğŸ”“ Vulnerabilidad**: **Supply Chain** â€” CWE-829
**ğŸ“ UbicaciÃ³n**:
- `frontend/index.html:36` (Font Awesome)
- `dashboard.html:29` (Chart.js)
- Replicado en todas las vistas
**âš ï¸ Severidad**: **Alta**
**ğŸ“œ EstÃ¡ndar**: OWASP A08:2021
**ğŸ› ï¸ MitigaciÃ³n**:
```html
<link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      integrity="sha512-iecdLmaskl0HPYkZh4Nqu..."
      crossorigin="anonymous" referrerpolicy="no-referrer" />
```
**Nota positiva**: Leaflet en `geoportal/*.html` SÃ implementa SRI correctamente.

---

## SEC-004 Â· DOM-based XSS: innerHTML con datos de API sin sanitizaciÃ³n
**â— Hallazgo**: Se contabilizan 200+ usos de `.innerHTML` con template literals que interpolan datos directamente del backend (nombres de proyectos, descripciones, observaciones). Si el backend almacena payload XSS, se ejecuta en el navegador.
**ğŸ”“ Vulnerabilidad**: **DOM-based XSS** â€” CWE-79
**ğŸ“ UbicaciÃ³n** (muestras representativas):
- `layout.js:20,155` â€” userName, roleName desde localStorage
- `dashboard.html:439` â€” nombres de proyectos del API
- `proyecto.html:379` â€” renderizado de tabla con datos de API
- `help.js:337-339` â€” `message` en alertas
- `index.html:339` â€” `message` de error en alerta
**âš ï¸ Severidad**: **Alta**
**ğŸ“œ EstÃ¡ndar**: OWASP A03:2021 â€” Injection
**ğŸ› ï¸ MitigaciÃ³n**:
```javascript
// Helper de escape:
function escapeHTML(str) {
    const div = document.createElement('div');
    div.textContent = str;
    return div.innerHTML;
}
// Uso:
container.innerHTML = `<span>${escapeHTML(userName)}</span>`;
```

---

## SEC-005 Â· JWT Token y PII en localStorage (vulnerable a XSS)
**â— Hallazgo**: `authToken` (JWT) y `userData` (nombre, roles, nivel de acceso) se almacenan en `localStorage`. Dado SEC-004, un XSS exitoso permite exfiltrar ambos.
**ğŸ”“ Vulnerabilidad**: **Insecure Storage** â€” CWE-922
**ğŸ“ UbicaciÃ³n**:
- `frontend/index.html:291-293` (escritura)
- `frontend/script/api.js:6` (lectura)
- `frontend/script/router.js:43-51` (lectura)
**âš ï¸ Severidad**: **Alta**
**ğŸ“œ EstÃ¡ndar**: OWASP A07:2021 / GDPR Art. 32 (integridad y confidencialidad)
**ğŸ› ï¸ MitigaciÃ³n**:
1. Migrar JWT a cookies `HttpOnly; Secure; SameSite=Strict`.
2. Si `localStorage` es necesario, minimizar PII almacenada.
3. Implementar token refresh con corta expiraciÃ³n.

---

## SEC-006 Â· API Key ofuscada con XOR reversible
**â— Hallazgo**: `router.js` contiene una funciÃ³n `getKey(seed)` que decodifica una API key mediante XOR simple con un seed. Este esquema es trivialmente reversible â€” la key queda expuesta a cualquier usuario que inspeccione el cÃ³digo.
**ğŸ”“ Vulnerabilidad**: **Secret Exposure** â€” CWE-798
**ğŸ“ UbicaciÃ³n**: `frontend/script/router.js:99-115`
**âš ï¸ Severidad**: **Alta**
**ğŸ“œ EstÃ¡ndar**: OWASP A07:2021
**ğŸ› ï¸ MitigaciÃ³n**: Mover la key al backend. El frontend debe obtener tokens temporales via endpoint protegido, nunca contener secretos.

---

## SEC-007 Â· Hardcoded API URL con IP pÃºblica
**â— Hallazgo**: La URL del backend `https://186.67.61.251:8000` estÃ¡ hardcoded en `api.js` y `index.html`. Expone la IP del servidor y dificulta la rotaciÃ³n de infraestructura.
**ğŸ”“ Vulnerabilidad**: **Information Disclosure** â€” CWE-200
**ğŸ“ UbicaciÃ³n**:
- `frontend/script/api.js:4`
- `frontend/index.html:280`
**âš ï¸ Severidad**: **Media**
**ğŸ“œ EstÃ¡ndar**: OWASP A01:2021 â€” Broken Access Control
**ğŸ› ï¸ MitigaciÃ³n**: Usar dominio con DNS + reverse proxy (nginx). Centralizar en una constante configurable o variable de entorno build-time.

---

## SEC-008 Â· Data Leak: console.log(localStorage) en producciÃ³n
**â— Hallazgo**: MÃºltiples vistas imprimen el contenido completo de `localStorage` â€” incluyendo JWT y datos de usuario â€” en la consola del navegador.
**ğŸ”“ Vulnerabilidad**: **PII Leak** â€” CWE-532
**ğŸ“ UbicaciÃ³n**: 5+ archivos (ver ERR-009 en error-watcher report)
**âš ï¸ Severidad**: **Media**
**ğŸ“œ EstÃ¡ndar**: GDPR Art. 5(1)(f) â€” Integridad y confidencialidad
**ğŸ› ï¸ MitigaciÃ³n**: Eliminar `console.log(localStorage)`. Implementar logging condicional: `if (DEBUG_MODE) console.log(...)`.

---

## SEC-009 Â· ComparaciÃ³n dÃ©bil (==) para lÃ³gica de control de acceso
**â— Hallazgo**: La determinaciÃ³n de rutas post-login usa `==` para comparar `nivel_acceso`: `if (data.user.nivel_acceso == 10)`. Type coercion podrÃ­a permitir bypass si el server retorna string `"10"`.
**ğŸ”“ Vulnerabilidad**: **Type Coercion Bypass** â€” CWE-697
**ğŸ“ UbicaciÃ³n**: `frontend/index.html:303`
**âš ï¸ Severidad**: **Media**
**ğŸ“œ EstÃ¡ndar**: OWASP A01:2021
**ğŸ› ï¸ MitigaciÃ³n**: Usar `===` (igualdad estricta) o `Number(data.user.nivel_acceso) === 10`.

---

## SEC-010 Â· Ausencia de Content Security Policy
**â— Hallazgo**: No se detecta `<meta http-equiv="Content-Security-Policy">` ni headers CSP del servidor. Esto permite la carga y ejecuciÃ³n de scripts de cualquier origen.
**ğŸ”“ Vulnerabilidad**: **Missing Security Header** â€” CWE-693
**ğŸ“ UbicaciÃ³n**: Global (todos los HTMLs)
**âš ï¸ Severidad**: **Media**
**ğŸ“œ EstÃ¡ndar**: OWASP A05:2021
**ğŸ› ï¸ MitigaciÃ³n**: Implementar CSP vÃ­a meta tag o nginx config:
```
Content-Security-Policy: default-src 'self'; script-src 'self' cdn.tailwindcss.com cdn.jsdelivr.net cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' fonts.googleapis.com cdnjs.cloudflare.com; font-src fonts.gstatic.com cdnjs.cloudflare.com;
```

---

## ğŸ“Š RESUMEN DE SEVERIDAD

| Severidad | Cantidad | IDs |
|-----------|----------|-----|
| ğŸ”´ CrÃ­tica | 2 | SEC-001, SEC-002 |
| ğŸŸ  Alta | 4 | SEC-003, SEC-004, SEC-005, SEC-006 |
| ğŸŸ¡ Media | 4 | SEC-007, SEC-008, SEC-009, SEC-010 |
| ğŸŸ¢ Baja | 0 | â€” |
